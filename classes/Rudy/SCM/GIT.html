<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>: Rudy::SCM::GIT [Rudy: Not your grandparents' EC2 deployment tool.]</title>
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <link href='../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='class' id='wrapper'>
      <div class='header'>
        <h1 class='name'>
          <span class='type'>Class</span>
          Rudy::SCM::GIT
        </h1>
        <ol class='paths'>
          <li>
            <a href="../../../files/lib/rudy/scm/git_rb.html">lib/rudy/scm/git.rb</a>
          </li>
        </ol>
        <div class='parent'>
          Parent:
          <strong>Object</strong>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000205">clean_working_copy?</a></li>
              <li><a href="#M000196">new</a></li>
              <li><a href="#M000207">working_copy?</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000206">clean_working_copy?</a></li>
              <li><a href="#M000199">create_release</a></li>
              <li><a href="#M000202">create_remote_checkout</a></li>
              <li><a href="#M000201">delete_rtag</a></li>
              <li><a href="#M000197">engine</a></li>
              <li><a href="#M000200">find_next_rtag</a></li>
              <li><a href="#M000203">get_remote_uri</a></li>
              <li><a href="#M000198">liner_note</a></li>
              <li><a href="#M000209">raise_early_exceptions</a></li>
              <li><a href="#M000204">valid_rtag?</a></li>
              <li><a href="#M000208">working_copy?</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='includes'>
              <h2>Included modules</h2>
              <ol>
                <li><a href="ObjectBase.html">Rudy::SCM::ObjectBase</a></li>
                <li>Grit</li>
              </ol>
            </div>
          </div>
          <div id='section'>
            <div id='attribute-list'>
              <h2 class='section-bar'>Attributes</h2>
              <div class='name-list'>
                <table>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>base_uri</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>branch</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>changes</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>pkey</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>rbox</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>remote</td>
                    <td class='context-item-value'>[RW]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>repo</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>rtag</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                  <tr class='top-aligned-row context-row'>
                    <td class='context-item-name'>user</td>
                    <td class='context-item-value'>[R]</td>
                    <td class='context-item-desc'></td>
                  </tr>
                </table>
              </div>
            </div>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='public-class method' id='method-M000205'>
                <a name='M000205'>      </a>
                <div class='synopsis'>
                  <span class='name'>clean_working_copy?</span>
                  <span class='arguments'>(path=Dir.pwd)</span>
                </div>
                <div class='description'>
                  <p>
                  Are all local changes committed?
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000205-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000205-source'>     <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 189</span>&#x000A;189:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">clean_working_copy?</span>(<span class="ruby-identifier">path</span>=<span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>)&#x000A;190:         <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">:git</span>, <span class="ruby-value str">'diff'</span>).<span class="ruby-identifier">stdout</span> <span class="ruby-operator">==</span> []&#x000A;191:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000196'>
                <a name='M000196'>      </a>
                <div class='synopsis'>
                  <span class='name'>new</span>
                  <span class='arguments'>(args={})</span>
                </div>
                <div class='description'>
                  <ul>
                  <li><tt>args</tt> a hash of params from the git block in the routines config
                  
                  </li>
                  </ul>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000196-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000196-source'>    <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 24</span>&#x000A;24:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">initialize</span>(<span class="ruby-identifier">args</span>={})&#x000A;25:         <span class="ruby-identifier">args</span> = {&#x000A;26:           <span class="ruby-identifier">:privatekey</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>,&#x000A;27:           <span class="ruby-identifier">:remote</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:origin</span>,&#x000A;28:           <span class="ruby-identifier">:branch</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:master</span>,&#x000A;29:           <span class="ruby-identifier">:user</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:root</span>,&#x000A;30:           <span class="ruby-identifier">:changes</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">:enforce</span>,&#x000A;31:           <span class="ruby-identifier">:path</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">nil</span>&#x000A;32:         }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">args</span>)&#x000A;33:         <span class="ruby-ivar">@remote</span>, <span class="ruby-ivar">@branch</span>, <span class="ruby-ivar">@path</span> = <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:remote</span>], <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:branch</span>], <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:path</span>]&#x000A;34:         <span class="ruby-ivar">@user</span>, <span class="ruby-ivar">@pkey</span>, <span class="ruby-ivar">@changes</span> = <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:user</span>], <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:privatekey</span>], <span class="ruby-identifier">args</span>[<span class="ruby-identifier">:changes</span>]&#x000A;35:         <span class="ruby-ivar">@repo</span> = <span class="ruby-constant">Repo</span>.<span class="ruby-identifier">new</span>(<span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-constant">GIT</span>.<span class="ruby-identifier">working_copy?</span>&#x000A;36:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-class method' id='method-M000207'>
                <a name='M000207'>      </a>
                <div class='synopsis'>
                  <span class='name'>working_copy?</span>
                  <span class='arguments'>(path=Dir.pwd)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000207-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000207-source'>     <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 194</span>&#x000A;194:       <span class="ruby-keyword kw">def</span> <span class="ruby-keyword kw">self</span>.<span class="ruby-identifier">working_copy?</span>(<span class="ruby-identifier">path</span>=<span class="ruby-constant">Dir</span>.<span class="ruby-identifier">pwd</span>)&#x000A;195:         (<span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-constant">File</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">path</span>, <span class="ruby-value str">'.git'</span>)))&#x000A;196:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='public-instance method' id='method-M000206'>
                <a name='M000206'>      </a>
                <div class='synopsis'>
                  <span class='name'>clean_working_copy?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000206-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000206-source'>     <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 192</span>&#x000A;192:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">clean_working_copy?</span>; <span class="ruby-constant">GIT</span>.<span class="ruby-identifier">clean_working_copy?</span>; <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000199'>
                <a name='M000199'>      </a>
                <div class='synopsis'>
                  <span class='name'>create_release</span>
                  <span class='arguments'>(username=nil, msg=nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000199-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000199-source'>    <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 44</span>&#x000A;44:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_release</span>(<span class="ruby-identifier">username</span>=<span class="ruby-keyword kw">nil</span>, <span class="ruby-identifier">msg</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;45:         <span class="ruby-ivar">@rtag</span> = <span class="ruby-identifier">find_next_rtag</span>(<span class="ruby-identifier">username</span>)&#x000A;46:         <span class="ruby-identifier">msg</span> <span class="ruby-operator">||=</span> <span class="ruby-value str">'Another Release by Rudy!'</span>&#x000A;47:         <span class="ruby-identifier">msg</span>.<span class="ruby-identifier">tr!</span>(<span class="ruby-value str">&quot;'&quot;</span>, <span class="ruby-value str">&quot;''&quot;</span>)&#x000A;48:         <span class="ruby-identifier">ret</span> = <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">:git</span>, <span class="ruby-value str">&quot;tag&quot;</span>, <span class="ruby-ivar">@rtag</span>)  <span class="ruby-comment cmt"># Use annotated? -a -m '#{msg}' </span>&#x000A;49:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">$/</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">exit_code</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;50:         <span class="ruby-identifier">ret</span> = <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">:git</span>, <span class="ruby-value str">&quot;push&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remote</span>&#x000A;51:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">$/</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">exit_code</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;52:         <span class="ruby-identifier">ret</span> = <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">:git</span>, <span class="ruby-node">&quot;push #{@remote} #{rtag}&quot;</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remote</span>&#x000A;53:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">$/</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">exit_code</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;54:         <span class="ruby-ivar">@rtag</span>&#x000A;55:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000202'>
                <a name='M000202'>      </a>
                <div class='synopsis'>
                  <span class='name'>create_remote_checkout</span>
                  <span class='arguments'>(rbox)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000202-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000202-source'>     <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 80</span>&#x000A; 80:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">create_remote_checkout</span>(<span class="ruby-identifier">rbox</span>)&#x000A; 81:         &#x000A; 82:         <span class="ruby-comment cmt"># Make sure the directory above the clone path exists </span>&#x000A; 83:         <span class="ruby-comment cmt"># and that it's owned by the request user. </span>&#x000A; 84:         <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">:p</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-ivar">@path</span>)) &#x000A; 85:         <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">chown</span>(<span class="ruby-ivar">@user</span>, <span class="ruby-constant">File</span>.<span class="ruby-identifier">dirname</span>(<span class="ruby-ivar">@path</span>)) &#x000A; 86:         &#x000A; 87:         <span class="ruby-keyword kw">begin</span>&#x000A; 88:           <span class="ruby-identifier">original_user</span> = <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">user</span>&#x000A; 89:           <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">switch_user</span>(<span class="ruby-ivar">@user</span>)&#x000A; 90:           &#x000A; 91:           <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@pkey</span>&#x000A; 92:             <span class="ruby-comment cmt"># Try when debugging: ssh -vi path/2/pkey git@github.com</span>&#x000A; 93:             <span class="ruby-identifier">key</span> = <span class="ruby-constant">File</span>.<span class="ruby-identifier">basename</span>(<span class="ruby-ivar">@pkey</span>)&#x000A; 94:             <span class="ruby-identifier">homedir</span> = <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">getenv</span>[<span class="ruby-value str">'HOME'</span>]&#x000A; 95:             <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">mkdir</span>(<span class="ruby-identifier">:p</span>, <span class="ruby-identifier">:m</span>, <span class="ruby-value str">'700'</span>, <span class="ruby-value str">'.ssh'</span>) <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span> <span class="ruby-comment cmt"># :p says keep quiet if it exists              </span>&#x000A; 96:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">file_exists?</span>(<span class="ruby-node">&quot;.ssh/#{key}&quot;</span>)&#x000A; 97:               <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  Remote private key #{key} already exists&quot;</span>.<span class="ruby-identifier">colour</span>(<span class="ruby-identifier">:red</span>)&#x000A; 98:             <span class="ruby-keyword kw">else</span>&#x000A; 99:               <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">upload</span>(<span class="ruby-ivar">@pkey</span>, <span class="ruby-node">&quot;.ssh/#{key}&quot;</span>)&#x000A;100:             <span class="ruby-keyword kw">end</span>&#x000A;101:             &#x000A;102:             <span class="ruby-comment cmt">## NOTE: The following are two attempts at telling git which </span>&#x000A;103:             <span class="ruby-comment cmt">## private key to use. Both fail. The only thing I could get</span>&#x000A;104:             <span class="ruby-comment cmt">## to work is modifying the ~/.ssh/config file. </span>&#x000A;105:             <span class="ruby-comment cmt">##</span>&#x000A;106:             <span class="ruby-comment cmt">## This runs fine, but &quot;git clone&quot; doesn't care. </span>&#x000A;107:             <span class="ruby-comment cmt">## git config --global --replace-all http.sslKey /home/delano/.ssh/id_rsa</span>&#x000A;108:             <span class="ruby-comment cmt">## rbox.git('config', '--global', '--replace-all', 'http.sslKey', &quot;#{homedir}/.ssh/#{key}&quot;)</span>&#x000A;109:             <span class="ruby-comment cmt">##</span>&#x000A;110:             <span class="ruby-comment cmt">## &quot;git clone&quot; doesn't care about this either. Note that both these</span>&#x000A;111:             <span class="ruby-comment cmt">## config attempts come directly from the git-config man page:</span>&#x000A;112:             <span class="ruby-comment cmt">## http://www.kernel.org/pub/software/scm/git/docs/git-config.html</span>&#x000A;113:             <span class="ruby-comment cmt">## export GIT_SSL_KEY=/home/delano/.ssh/id_rsa</span>&#x000A;114:             <span class="ruby-comment cmt">## rbox.setenv(&quot;GIT_SSL_KEY&quot;, &quot;#{homedir}/.ssh/#{key}&quot;)</span>&#x000A;115:             &#x000A;116:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">file_exists?</span>(<span class="ruby-value str">'.ssh/config'</span>)&#x000A;117:               <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-value str">'.ssh/config'</span>, <span class="ruby-value str">&quot;.ssh/config-previous&quot;</span>)&#x000A;118:               <span class="ruby-identifier">ssh_config</span> = <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">download</span>(<span class="ruby-value str">'.ssh/config'</span>)&#x000A;119:             <span class="ruby-keyword kw">end</span>&#x000A;120:             &#x000A;121:             <span class="ruby-identifier">ssh_config</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>&#x000A;122:             <span class="ruby-identifier">ssh_config</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">$/</span>, <span class="ruby-node">&quot;IdentityFile #{homedir}/.ssh/#{key}&quot;</span>&#x000A;123:             <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  Adding IdentityFile #{key} to #{homedir}/.ssh/config&quot;</span>&#x000A;124:             &#x000A;125:             <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">upload</span>(<span class="ruby-identifier">ssh_config</span>, <span class="ruby-value str">'.ssh/config'</span>)&#x000A;126:             <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-value str">'0600'</span>, <span class="ruby-value str">'.ssh/config'</span>)&#x000A;127:             &#x000A;128:           <span class="ruby-keyword kw">end</span>&#x000A;129:           &#x000A;130:           <span class="ruby-comment cmt"># We need to add the host keys to the user's known_hosts file</span>&#x000A;131:           <span class="ruby-comment cmt"># to prevent the git commands from failing when it raises the</span>&#x000A;132:           <span class="ruby-comment cmt"># &quot;Host key verification failed.&quot; messsage.</span>&#x000A;133:           <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">file_exists?</span>(<span class="ruby-value str">'.ssh/known_hosts'</span>)&#x000A;134:             <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">cp</span>(<span class="ruby-value str">'.ssh/known_hosts'</span>, <span class="ruby-value str">&quot;.ssh/known_hosts-previous&quot;</span>)&#x000A;135:             <span class="ruby-identifier">known_hosts</span> = <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">download</span>(<span class="ruby-value str">'.ssh/known_hosts'</span>)&#x000A;136:           <span class="ruby-keyword kw">end</span>&#x000A;137:           <span class="ruby-identifier">known_hosts</span> <span class="ruby-operator">||=</span> <span class="ruby-constant">StringIO</span>.<span class="ruby-identifier">new</span>&#x000A;138:           <span class="ruby-identifier">remote</span> = <span class="ruby-identifier">get_remote_uri</span>&#x000A;139:           <span class="ruby-identifier">host</span> = <span class="ruby-constant">URI</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">remote</span>).<span class="ruby-identifier">host</span> <span class="ruby-keyword kw">rescue</span> <span class="ruby-keyword kw">nil</span>&#x000A;140:           <span class="ruby-identifier">host</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">remote</span>.<span class="ruby-identifier">scan</span>(<span class="ruby-regexp re">/\A.+?@(.+?)\:/</span>).<span class="ruby-identifier">flatten</span>.<span class="ruby-identifier">first</span>&#x000A;141:           <span class="ruby-identifier">known_hosts</span>.<span class="ruby-identifier">puts</span> <span class="ruby-identifier">$/</span>, <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">remote_host_keys</span>(<span class="ruby-identifier">host</span>)&#x000A;142:           <span class="ruby-identifier">puts</span> <span class="ruby-node">&quot;  Adding host key for #{host} to .ssh/known_hosts&quot;</span>&#x000A;143: &#x000A;144:           <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">upload</span>(<span class="ruby-identifier">known_hosts</span>, <span class="ruby-value str">'.ssh/known_hosts'</span>)&#x000A;145:           <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">chmod</span>(<span class="ruby-value str">'0600'</span>, <span class="ruby-value str">'.ssh/known_hosts'</span>)&#x000A;146: &#x000A;147:           <span class="ruby-identifier">execute_rbox_command</span> {&#x000A;148:             <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">git</span>(<span class="ruby-value str">'clone'</span>, <span class="ruby-identifier">get_remote_uri</span>, <span class="ruby-ivar">@path</span>)&#x000A;149:           }&#x000A;150:           <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">cd</span>(<span class="ruby-ivar">@path</span>)&#x000A;151:           <span class="ruby-identifier">execute_rbox_command</span> {&#x000A;152:             <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">git</span>(<span class="ruby-value str">'checkout'</span>, <span class="ruby-identifier">:b</span>, <span class="ruby-ivar">@rtag</span>)&#x000A;153:           }&#x000A;154:         <span class="ruby-keyword kw">rescue</span> <span class="ruby-constant">Rye</span><span class="ruby-operator">::</span><span class="ruby-constant">CommandError</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">ex</span>&#x000A;155:           <span class="ruby-identifier">puts</span> <span class="ruby-identifier">ex</span>.<span class="ruby-identifier">message</span>&#x000A;156:         <span class="ruby-keyword kw">ensure</span>&#x000A;157:           <span class="ruby-comment cmt"># Return to the original user and directory</span>&#x000A;158:           <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">switch_user</span>(<span class="ruby-identifier">original_user</span>)&#x000A;159:           <span class="ruby-identifier">rbox</span>.<span class="ruby-identifier">cd</span>&#x000A;160:         <span class="ruby-keyword kw">end</span>&#x000A;161:         &#x000A;162:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000201'>
                <a name='M000201'>      </a>
                <div class='synopsis'>
                  <span class='name'>delete_rtag</span>
                  <span class='arguments'>(rtag=nil)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000201-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000201-source'>    <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 70</span>&#x000A;70:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">delete_rtag</span>(<span class="ruby-identifier">rtag</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;71:         <span class="ruby-identifier">rtag</span> <span class="ruby-operator">||=</span> <span class="ruby-ivar">@rtag</span>&#x000A;72:         <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">execute_rbox_command</span> { <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">:git</span>, <span class="ruby-value str">'tag'</span>, <span class="ruby-identifier">:d</span>, <span class="ruby-identifier">rtag</span>) }&#x000A;73:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">$/</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">exit_code</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span> <span class="ruby-comment cmt"># TODO: retest</span>&#x000A;74:         <span class="ruby-comment cmt"># Equivalent to: &quot;git push origin :tag-name&quot; which deletes a remote tag</span>&#x000A;75:         <span class="ruby-identifier">ret</span> = <span class="ruby-identifier">execute_rbox_command</span> { <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">:git</span>, <span class="ruby-node">&quot;push #{@remote} :#{rtag}&quot;</span>) } <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@remote</span>&#x000A;76:         <span class="ruby-identifier">raise</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">stderr</span>.<span class="ruby-identifier">join</span>(<span class="ruby-identifier">$/</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">exit_code</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>&#x000A;77:         <span class="ruby-keyword kw">true</span>&#x000A;78:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000197'>
                <a name='M000197'>      </a>
                <div class='synopsis'>
                  <span class='name'>engine</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000197-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000197-source'>    <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 38</span>&#x000A;38:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">engine</span>; <span class="ruby-identifier">:git</span>; <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000200'>
                <a name='M000200'>      </a>
                <div class='synopsis'>
                  <span class='name'>find_next_rtag</span>
                  <span class='arguments'>(username=nil)</span>
                </div>
                <div class='description'>
                  <p>
                  rel-2009-03-05-user-rev
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000200-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000200-source'>    <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 58</span>&#x000A;58:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">find_next_rtag</span>(<span class="ruby-identifier">username</span>=<span class="ruby-keyword kw">nil</span>)&#x000A;59:         <span class="ruby-identifier">now</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>&#x000A;60:         <span class="ruby-identifier">mon</span> = <span class="ruby-identifier">now</span>.<span class="ruby-identifier">mon</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">rjust</span>(<span class="ruby-value">2</span>, <span class="ruby-value str">'0'</span>)&#x000A;61:         <span class="ruby-identifier">day</span> = <span class="ruby-identifier">now</span>.<span class="ruby-identifier">day</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">rjust</span>(<span class="ruby-value">2</span>, <span class="ruby-value str">'0'</span>)&#x000A;62:         <span class="ruby-identifier">rev</span> = <span class="ruby-value str">&quot;01&quot;</span>&#x000A;63:         <span class="ruby-identifier">criteria</span> = [<span class="ruby-value str">'rel'</span>, <span class="ruby-identifier">now</span>.<span class="ruby-identifier">year</span>, <span class="ruby-identifier">mon</span>, <span class="ruby-identifier">day</span>, <span class="ruby-identifier">rev</span>]&#x000A;64:         <span class="ruby-identifier">criteria</span>.<span class="ruby-identifier">insert</span>(<span class="ruby-value">-2</span>, <span class="ruby-identifier">username</span>) <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">username</span>&#x000A;65:         <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">succ!</span> <span class="ruby-keyword kw">while</span> <span class="ruby-identifier">valid_rtag?</span>(<span class="ruby-identifier">criteria</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">Rudy</span><span class="ruby-operator">::</span><span class="ruby-constant">DELIM</span>)) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&lt;</span> <span class="ruby-value">50</span>&#x000A;66:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">TooManyTags</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">rev</span>.<span class="ruby-identifier">to_i</span> <span class="ruby-operator">&gt;=</span> <span class="ruby-value">50</span>&#x000A;67:         <span class="ruby-identifier">criteria</span>.<span class="ruby-identifier">join</span>(<span class="ruby-constant">Rudy</span><span class="ruby-operator">::</span><span class="ruby-constant">DELIM</span>)&#x000A;68:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000203'>
                <a name='M000203'>      </a>
                <div class='synopsis'>
                  <span class='name'>get_remote_uri</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000203-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000203-source'>     <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 165</span>&#x000A;165:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">get_remote_uri</span>&#x000A;166:         <span class="ruby-identifier">ret</span> = <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">:git</span>, <span class="ruby-value str">&quot;config&quot;</span>, <span class="ruby-node">&quot;remote.#{@remote}.url&quot;</span>)&#x000A;167:         <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">first</span>&#x000A;168:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000198'>
                <a name='M000198'>      </a>
                <div class='synopsis'>
                  <span class='name'>liner_note</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000198-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000198-source'>    <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 40</span>&#x000A;40:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">liner_note</span>&#x000A;41:         <span class="ruby-value str">&quot;%-40s  (git:%s:%s)&quot;</span> <span class="ruby-operator">%</span> [<span class="ruby-ivar">@rtag</span>, <span class="ruby-ivar">@remote</span>, <span class="ruby-ivar">@branch</span>]&#x000A;42:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000209'>
                <a name='M000209'>      </a>
                <div class='synopsis'>
                  <span class='name'>raise_early_exceptions</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000209-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000209-source'>     <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 199</span>&#x000A;199:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">raise_early_exceptions</span>&#x000A;200:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NotAWorkingCopy</span>, <span class="ruby-identifier">:git</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">working_copy?</span>&#x000A;201:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">DirtyWorkingCopy</span>, <span class="ruby-identifier">:git</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-ivar">@changes</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-value str">'ignore'</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">clean_working_copy?</span>&#x000A;202:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoRemoteURI</span>, <span class="ruby-node">&quot;remote.#{@remote}.url not set&quot;</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">get_remote_uri</span>.<span class="ruby-identifier">nil?</span>&#x000A;203:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">NoRemotePath</span>, <span class="ruby-identifier">:git</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@path</span>.<span class="ruby-identifier">nil?</span>&#x000A;204:         <span class="ruby-identifier">raise</span> <span class="ruby-constant">PrivateKeyNotFound</span>, <span class="ruby-ivar">@pkey</span> <span class="ruby-keyword kw">if</span> <span class="ruby-ivar">@pkey</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-constant">File</span>.<span class="ruby-identifier">exists?</span>(<span class="ruby-ivar">@pkey</span>)&#x000A;205:         <span class="ruby-identifier">find_next_rtag</span> <span class="ruby-comment cmt"># will raise exception is there's a problem</span>&#x000A;206:         &#x000A;207:         <span class="ruby-comment cmt"># We can't check stuff that requires access to the machine b/c the </span>&#x000A;208:         <span class="ruby-comment cmt"># machine may not be running yet. These include:</span>&#x000A;209:         <span class="ruby-comment cmt"># * Remote checkout path already exists</span>&#x000A;210:         <span class="ruby-comment cmt"># * No git available</span>&#x000A;211:         <span class="ruby-comment cmt"># ...</span>&#x000A;212:         <span class="ruby-comment cmt"># If create_remote_checkout should fail, it should print a message</span>&#x000A;213:         <span class="ruby-comment cmt"># about the release that was created and how to install it manually</span>&#x000A;214:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000204'>
                <a name='M000204'>      </a>
                <div class='synopsis'>
                  <span class='name'>valid_rtag?</span>
                  <span class='arguments'>(tag)</span>
                </div>
                <div class='description'>
                  <pre>Check if the given remote is valid.</pre>
                  <p>
                  def has_remote?(remote)
                  </p>
                  <pre>success = false&#x000A;(@repo.remotes || []).each do |r|&#x000A;end&#x000A;success</pre>
                  <p>
                  end
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000204-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000204-source'>     <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 178</span>&#x000A;178:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">valid_rtag?</span>(<span class="ruby-identifier">tag</span>)&#x000A;179:         <span class="ruby-comment cmt"># git tag -l tagname returns a 0 exit code and stdout is empty</span>&#x000A;180:         <span class="ruby-comment cmt"># when a tag does not exit. When it does exist, the exit code</span>&#x000A;181:         <span class="ruby-comment cmt"># is 0 and stdout contains the tagname. </span>&#x000A;182:         <span class="ruby-identifier">ret</span> = <span class="ruby-constant">Rye</span>.<span class="ruby-identifier">shell</span>(<span class="ruby-identifier">:git</span>, <span class="ruby-value str">'tag'</span>, <span class="ruby-identifier">:l</span>, <span class="ruby-identifier">tag</span>)  &#x000A;183:         <span class="ruby-comment cmt"># change :l to :d for quick deleting above and return true</span>&#x000A;184:         <span class="ruby-comment cmt"># OR: just change to :d to always recreate the same tag</span>&#x000A;185:         (<span class="ruby-identifier">ret</span>.<span class="ruby-identifier">exit_code</span> <span class="ruby-operator">==</span> <span class="ruby-value">0</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">ret</span>.<span class="ruby-identifier">stdout</span>.<span class="ruby-identifier">to_s</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">tag</span>)&#x000A;186:       <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='public-instance method' id='method-M000208'>
                <a name='M000208'>      </a>
                <div class='synopsis'>
                  <span class='name'>working_copy?</span>
                  <span class='arguments'>()</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000208-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000208-source'>     <span class="ruby-comment cmt"># File lib/rudy/scm/git.rb, line 197</span>&#x000A;197:       <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">working_copy?</span>; <span class="ruby-constant">GIT</span>.<span class="ruby-identifier">working_copy?</span>; <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
